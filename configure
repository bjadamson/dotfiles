#!/usr/bin/env python2.7
import os, sys
from os.path import expanduser
import shutil

def clone_vundle(homedir):
    dst = homedir + '/.vim/bundle/Vundle.vim'
    print dst
    if os.path.exists(dst):
        shutil.rmtree(dst)
    os.system('git clone https://github.com/gmarik/Vundle.vim.git ' + dst)

def symlink_thing(prefix, homedir, dotfile, target):
    dst = homedir + '/' + dotfile
    if os.path.islink(dst):
        val = os.unlink(dst)
    val = os.symlink(prefix + target, dst)
    print "val '" + str(val) + "'"

def main(argv):
    """AFTER the symlink to the vim directory has been created, we can then only clone the vundle
    package.
    """
    """The only ordering that matters here is that
    1. Create VIM symlink
    2. Clone the vundle package.
    """
    prefix = sys.path[0]
    homedir = expanduser("~")
    # Step 1. (see ordering)
    symlink_thing(prefix, homedir, '.vim', '/vim')
    # Step 2 (now safe to clone vundle)
    clone_vundle(homedir)

    # Step 2. symlink all the other things.
    symlink_thing(prefix, homedir, '.gitconfig', '/git/gitconfig')
    symlink_thing(prefix, homedir, '.config/fish', '/fish')
    symlink_thing(prefix, homedir, '.config/amethyst', '/amethyst')
    print "Done"

main(sys.argv)
